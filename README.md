# npm
Руководство по npm.

`npm` - node package manger (менеджер пакетов и их зависимостей). `node.js` - серверный язык программирования javascript + дополнительные комопненты для работы с файлами, базами данных, http-запросами и т.д. Модульность - одна из особенностей node.js, функционал разбит на отдельные js-файлы (или группы файлов).

    const module_1 = require('module_1');

    module.exports = {
        module_1,
    }

Модули (пакеты) можно создавать самостоятельно и делиться ими в специальном публичном репозитори. `npm` - управялет этими модулями (пакетами). Все пакеты с описаниями хранятся в `https://www.npmjs.com`

Откроем например страницу с `gulp` https://www.npmjs.com/package/gulp:
- Перейдём на вкладку `Dependencies`:
    - Dependencies - пакеты необходимые для работы пакета gulp
    - Dev Dependencies - пакеты используемые при разработке пакета gulp (но на его работу не влияют)
- Вкладка `Dependents` содержит пакеты которые используют `gulp`

## Установка `npm`
npm входит в состав `node.js`, поэтому нужно установить `node.js`.

https://nodejs.org/en/
- LTS (стабильна рекомендованная)
- Current (текущая)

После установки, проверяем роботоспособность **node.js**, набираем в терминале `node -v`. Проверяем роботоспособность **npm** набираем в терминале `npm -v`.

## Workflow
- `npm init` - инициализация проекта (энтер)
- `npm init --yes` - быстрая инициализация проекта
- создастся файл `package.json`, где можно изменить данные инициализации

## Поиск пакета
Пакеты можно искать не только на сайте `npmjs.com` но и в терминале.
- `npm search имя-пакета` или `npm s имя-пакета`
- `npm search bootstrap`, получим список подходящих пакетов
- `npm search "bootstrap grid"`, ищем по нескольким словам
- `npm view имя-пакета` - показать более подробную информацию о пакете
- `npm repo имя-пакета` - открываем репозиторий пакета в github (откроется в браузере)
- `npm home имя-пакета` - перейти на домашнюю страницу пакета

## Установка пакета
После установки пакета в корне проекта появится папка `node_modules` и файл `package-lock.json`
- `npm install имя-пакета` или `npm i имя-пакета`
- `npm install bootstrap` - установим bootstrap

## Зависимости
Разработчик должен сам решить к какому виду зависимости отнести пакет при создании проекта:
- `dependencies` - пакеты необходимые для работы проекта (продакшн)
    - например библиотеки, фреймворки и т.п.
    - установим пакет: `npm i axios --save-prod` или `npm i axios -P` или `npm i axios` (с 8й версии node.js)
- `devDependencies` - пакеты используемые при разработке проекта
    - например сборщики, линтеры, шаблониаторы, тестирование и т.п.
    - установим сразу два пакета: `npm i gulp mocha --save-dev` или `npm i gulp mocha -D`

## node_modules
Мы установили всего 4 пакета, но папка node_modules стала содержать очень много различных пакетов, потому что многие из них зависят `dependencies` от других пакетов. Зависимости можно постротреть в файле `package.json` каждого пакета.

- `npm list --all` - посмотреть иерархию зависимостей вашего проекта

## Исполняемые файлы
Некоторые пакеты содержат исполняемые файлы, например `node_modules/gulp/bin/gulp.js`:

    require('gulp-cli')()

Исполняемые файлы могут содержаться в пакетах: тестов, линтеров, препроцессоров, сборщиков и т.д.  
Исполняемые файлы всех установленных пакетов также хранятся в `node_modules/.bin/` в виде ярлыков, к ним можно обращаться из нашего проекта:

    /package.json
        "scripts": {

        }

Создадим скрипт с именем `gulp`, который будет показывать версию `gulp`:

    "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1",
        "gulp": "gulp -v"
    },

Набираем в терминале `npm run gulp` нам должно вывести версию gulp. Еще можно работать с исполняемыми файлами пакетов, установив их глобально `-g` (они станут доступны из консоли в любом месте), например `gulp-cli` или веб-сервер.

Проверяем какие пакеты и где, установлены глобально: `npm list -g`. Глобальные пакеты к проекту не подключаются, глобально пакеты устанавливают для исполняемых файлов.

## Версии пакетов
Версии пакетов и их обновления. При установке по умолчани ставится последняя версия пакета. Версия пакета состоит из 3х чисел (мажор.минор.патч), см. файл `package.json`. Первое число "мажорная версия", означает что в пакет внесены критические изменения и теперь он не совместим с более старыми версиями.

- `npm outdated` проверить пакеты на доступные обновления
- `npm remove имя-пакета` или `npm r имя-пакета` или `npm uninstall имя-пакета` или `npm un имя-пакета` - удаляем пакет
- `npm view имя-пакета versions` - посмотреть список всех доступных версий пакета
- `npm i bootstrap@4.1.1` - устанавливаем версию пакета которая нам нужна (если оставить только 4, то установится последняя версия, но не бета)
    - сейчас сработает `npm outdated`
- `npm update` или `npm up` - обновляем все пакеты проекта
    - `npm up имя-пакета` - обновляем конкретный пакет
    - обновляются миноры и патчи
    - если убрать скобочку `^4.0.2`, то пакеты обновляться не будут
    - тильда `~4.0.2` обновляем только патчи
    - `*` разрешаем обновлять мажорные версии

## Перенос проекта на продакшн
- папку `node-modules` помещаем в `.gitignore`
    - node_modules
- чтобы развернуть проект в другой папке
    - помещаем в эту папку файл `package.json`
    - набираем команду `npm i`
    - `npm i --production` (пакеты из devDependencies не установятся)
